<!doctype html> <!--[if lt IE 7 ]><html class="ie ie6" lang=fr><![endif]--> <!--[if IE 7 ]><html class="ie ie7" lang=fr><![endif]--> <!--[if IE 8 ]><html class="ie ie8" lang=fr><![endif]--> <!--[if (gte IE 9)|!(IE)]><!--><html lang=fr> <!--<![endif]--> <html> <head> <meta charset=utf-8> <meta http-equiv=x-ua-compatible content="ie=edge"> <meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"> <html itemscope itemtype="http://schema.org/Article"> <title>Introduction aux annotations de type (Type Hints)</title> <meta name=description content=""> <meta itemprop=name content="Introduction aux annotations de type (Type Hints)"> <meta itemprop=description content=""> <meta name="twitter:title" content="Introduction aux annotations de type (Type Hints)"> <meta name="twitter:description" content=""> <meta name="twitter:creator" content="@celine_m_s"> <meta property="og:title" content="Introduction aux annotations de type (Type Hints)"/> <meta property="og:type" content=article /> <meta property="og:url" content="https://www.hello-birds.com/breves/2021-01-28-introduction-aux-annotations-de-type-type-hints.html"/> <meta property="og:description" content=""/> <meta property="og:site_name" content="Hello Birds"/> <meta property="article:published_time" content=2021-01-28 /> <meta property="article:section" content=breves /> <meta property="article:tag" content=Python /> <link rel=stylesheet href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin=anonymous> <link rel=stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css"/> <link href="/stylesheets/rouge-a7a497f1.css" rel=stylesheet /> <link href="/stylesheets/style-d09da798.css" rel=stylesheet /> <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--> <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" integrity="sha256-0rguYS0qgS6L4qVzANq4kjxPLtvnp5nn2nB5G1lWRv4=" crossorigin=anonymous></script> <link href='https://fonts.googleapis.com/css?family=Lato:100,300,400,700' rel=stylesheet> <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/solid.js" integrity="sha384-+Ga2s7YBbhOD6nie0DzrZpJes+b2K1xkpKxTFFcx59QmVPaSA8c7pycsNaFwUK6l" crossorigin=anonymous></script> <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/brands.js" integrity="sha384-sCI3dTBIJuqT6AwL++zH7qL8ZdKaHpxU43dDt9SyOzimtQ9eyRhkG3B7KMl6AO19" crossorigin=anonymous></script> <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/fontawesome.js" integrity="sha384-7ox8Q2yzO/uWircfojVuCQOZl+ZZBg2D2J5nkpLqzH1HY0C1dHlTKIbpRz/LG23c" crossorigin=anonymous></script> </head> <body id=top class="breves breves_2021 breves_2021_01 breves_2021_01_28 breves_2021_01_28_introduction-aux-annotations-de-type-type-hints breves_2021_01_28_introduction-aux-annotations-de-type-type-hints_index single"> <header class=""> <div class=overlay> <article style="transform: translate3d(0px, -27px, 0px); opacity: 1;"> <a href="/"> <h1 class=border-0>Hello Birds</h1> </a> <h2>Développement web · Formation</h2> </article> </div> </header> <nav class="navbar sticky-top navbar-expand-sm navbar-light bg-white"> <button class=navbar-toggler type=button data-toggle=collapse data-target="#navbarNav" aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> <div class="collapse navbar-collapse" id=navbarNav> <ul id=top-menu class="navbar-nav d-flex justify-content-center-sm align-content-between w-100"> <li class="nav-item flex-fill bg-white"> <a href="/" class="border-right align-middle">Accueil</a><span class=sr-only>(current)</span> </li> <li class="nav-item flex-fill bg-white"> <a href="/categories/breves/" class="border-right align-middle">Brèves</a> </li> <li class="nav-item flex-fill bg-white"> <a href="/a-propos/" class="border-right align-middle">Projets réalisés</a> </li> <li class="nav-item flex-fill bg-white"> <a href="/contact/" class=align-middle>Contact</a> </li> </ul> </div> </nav> <section class="p-5 bg-turquoise"> <div class="container bg-transparent"> <div class="moved-category-title "> <h1 class="title bg-white pt-4 pb-2"> Introduction aux annotations de type (Type Hints) </h1> <h2 class=meta> <span><i class="fa fa-user mr-2"></i><a href="/a-propos/">Céline Martinet Sanchez</a></span> <span><i class="fa fa-calendar mr-2"></i>28/01/2021</span> <span><i class="fa fa-folder-open mr-2"></i><a href="/categories/breves/">Breves</a></span> </h2> </div> </div> </section> <section class="pt-5 bg-white"> <div class=container> <div class=row> <div class="col-8 offset-2 category-description"> </div> </div> </div> </section> <section class="bg-white pt-5"> <div class="container article_page pt-4"> <p>Python est un langage dynamique, c&#39;est à dire que le type d&#39;une variable peut être changé a posteriori. </p> <p>Concrètement, cela permet d&#39;écrire ceci :</p> <div class=highlight><pre class="highlight python"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class=rouge-code><pre><span class="n">festival</span> <span class="o">=</span> <span class="s">"Les vieilles charues"</span> <span class="c1"># festival refers to a string
</span><span class="n">festival</span> <span class="o">=</span> <span class="mi">44190</span> <span class="c1"># now it refers to an integer
</span></pre></td></tr></tbody></table></code></pre></div> <p>Pourquoi voudrait-on changer cela ? Afin d&#39;être plus explicite sur le type attendu d&#39;une variable dans le cadre d&#39;une fonction, par exemple. Préciser le type attendu permet au premier coup d’œil de connaître le type d&#39;objet qu&#39;il est possible de passer en paramètre.</p> <p>Cela améliore la lisibilité du code et évite donc les erreurs.</p> <p>Considérons la fonction suivante :</p> <div class=highlight><pre class="highlight python"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class=rouge-code><pre><span class="k">def</span> <span class="nf">count_candies</span><span class="p">(</span><span class="n">candies</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">candies</span><span class="p">)</span>     

<span class="n">count_candies</span><span class="p">([</span><span class="s">"Dragibus"</span><span class="p">,</span> <span class="s">"Regal'ad"</span><span class="p">])</span>
<span class="c1"># 2
</span>
</pre></td></tr></tbody></table></code></pre></div> <p>Il est tout à fait possible de ne pas passer une liste à notre fonction du moment que la méthode <code>len</code> l&#39;autorise. Mais la fonction ne fera alors pas du tout ce pourquoi elle a été créée&hellip;</p> <div class=highlight><pre class="highlight python"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class=rouge-code><pre><span class="n">count_candies</span><span class="p">(</span><span class="s">"Mi-cho-ko"</span><span class="p">)</span>
<span class="c1"># 9
</span></pre></td></tr></tbody></table></code></pre></div> <p>Comment s&#39;assurer que le développeur qui utilisera <code>count_candies</code> passe bien une liste en paramètre ? Appelons les annotations de type, <code>Type Hints</code> en anglais, à la rescousse !</p> <div class=highlight><pre class="highlight python"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class=rouge-code><pre><span class="k">def</span> <span class="nf">count_candies</span><span class="p">(</span><span class="n">candies</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">candies</span><span class="p">)</span>

<span class="c1"># def my_function(argument_name: argument_type) -&gt; return_type:
#    pass
</span></pre></td></tr></tbody></table></code></pre></div> <p>Et voilà ! Magique !</p> <p>Nous pourrions nous attendre à ce que ces annotations soient contraignantes, c&#39;est-à-dire qu&#39;elles lèvent une erreur si un type incorrect est utilisé. Nous aurions tort car cela contreviendrait à l&#39;essence même du langage : son côté dynamique.</p> <p>Les annotations portent bien leur nom : ce sont des indications dont l&#39;objet est d&#39;améliorer la compréhension du code.</p> <p>Rappelons également que chaque fonction est une API exposant une interface plus ou moins complexe. Bien sûr, dans le cadre de notre exemple, elle est très simple. Mais il arrive fréquemment que des méthodes acceptent beaucoup d&#39;arguments et fassent plus de vingt lignes. Cela permet de savoir exactement ce qui est attendu en entrée et ce qui est renvoyé en sortie sans avoir à en disséquer les entrailles.</p> <p>Puisque ces annotations sont des indications qui améliorent la qualité d&#39;un projet, il est logique qu&#39;elles aient leur place dans un environnement de test ou une CI aux côtés de <em>linters</em> et de tests automatiques. <a href="https://mypy.readthedocs.io/en/stable/">La librairie mypy</a> semble être la plus utilisée à cet effet mais je n&#39;ai pas encore eu l&#39;occasion de jouer avec.</p> <p>Nous avons utilisé des annotations dans le cadre d&#39;un système de notifications personnalisé dans une app Django. Cela vous titille de savoir ce qui nous a amené à cette solution ? <a href="https://github.com/betagouv/itou/pull/444/files#diff-8126313c598b34f7657bec54fd01935f9abb2ef7b21bd273ff60f8a889042574R35">Lire notre échange sur GitHub</a>.</p> <div class=highlight><pre class="highlight python"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class=rouge-code><pre><span class="k">class</span> <span class="nc">NotificationBase</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recipients_qs</span><span class="p">:</span> <span class="p">[</span><span class="n">SiaeMembershipQuerySet</span><span class="p">,]):</span>
        <span class="s">"""
        `recipients_qs`: Django QuerySet leading to this notification recipients.
        We should be able to perform a `filter()` with it.
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">recipients_qs</span> <span class="o">=</span> <span class="n">recipients_qs</span>
        <span class="c1"># ...
</span></pre></td></tr></tbody></table></code></pre></div> <p>Je n&#39;ai pas testé, car nous n&#39;avons pas encore ajouté <code>mypy</code> au projet, mais je suppose très fortement qu&#39;aucune erreur ne serait levée si nous passions en paramètre un objet d&#39;un autre type que <code>SiaeMembershipQuerySet</code> , donc ne vous basez pas sur cet exemple. Pourquoi cette solution nous convient-elle alors ? Car elle a le mérite d&#39;être très explicite, tout simplement.</p> <p>Les annotations de type sont un concept bien plus vaste. Pour creuser le sujet, je conseille de lire attentivement les pages suivantes :</p> <ul> <li><a href="https://realpython.com/python-type-checking/">Python Type Checking (Guide</a>) (sur Real Python)</li> <li><a href="https://www.python.org/dev/peps/pep-0483/">PEP 483 &ndash; The Theory of Type Hints</a></li> <li><a href="https://www.python.org/dev/peps/pep-0484/">PEP 484 &ndash; Type Hints</a></li> <li><a href="https://docs.python.org/fr/3/library/typing.html">La doc du module typing</a></li> </ul> <ul class="list-unstyled pt-4"> <span><i class="fa fa-tags mr-2"></i></span> <span class=h4><a href="/etiquettes/python/" class="badge badge-secondary">Python</a></span> </ul> </div> </section> <section class=p-5> <div class=container> <div class="row d-flex align-items-top"> <div class="col-sm-3 offset-sm-3 col-md-2"> <img src="/images/celine-martinet-sanchez-9392704d.jpg" class="img-fluid rounded-circle px-5 p-sm-0" alt=""/> </div> <div class="col-sm-5 col-md-5 pt-3 pt-sm-0 text-center"> <p class="text-sm-left mb-2"><b>Céline Martinet Sanchez</b></p> <p class=text-sm-left> Freelance depuis 2014, je suis développeuse web et formatrice. Au travers de ce site, je parle de Python, de startups et de code en général. </p> <p class=text-sm-left> <a href="/a-propos/" class="btn btn-info btn-sm ">Découvrir mes projets</a> </p> </div> </div> </div> </section> <footer class=footer-copyright> <div class=container> <div class="row d-flex justify-content-center"> <ul class="social-networks list-inline text-center"> <li class=list-inline-item><a href="/feed.xml" target=_blank data-type=icon><i class="fas fa-rss-square"></i></a></li> <li class=list-inline-item><a href="http://fr.linkedin.com/in/celinemartinet1/" target=_blank data-type=icon><i class="fab fa-linkedin"></i></a></li> <li class=list-inline-item><a href="https://github.com/celine-m-s" target=_blank data-type=icon><i class="fab fa-github-square"></i></a> </li> <li class=list-inline-item><a href="https://twitter.com/celine_m_s" target=_blank data-type=icon><i class="fab fa-twitter-square"></i></a></li> <li class=list-inline-item><a href="/contact" data-type=icon><i class="fa fa-envelope-square"></i></a></li> </ul> </div> </div> </footer> <div id=preloader><div id=status><div class=spinner></div></div></div> <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-46442344-2', 'auto');
        ga('send', 'pageview');

        // If a click is made, send its link as an event.
        function handleOutboundLinkClicks(link) {
          ga('send', 'event', {
            eventCategory: link.dataset.type,
            eventAction: 'click',
            eventLabel: link.href,
            transport: 'beacon'
          });
        }

        $('a').click(function(){
          handleOutboundLinkClicks(this);
        });


      </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity=sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns crossorigin=anonymous></script> <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script> <script src="/javascripts/libraries-1b258993.js"></script> <script src="/javascripts/site-2a91e838.js"></script> </body> </html>